
mediawiki:
  image: discosquad/tdsmediawiki
  restart: always
  environment:
    - WIKI_URL=
    - WIKI_DB_NAME=
    - WIKI_DB_USER=
    - WIKI_DB_PASSWORD=
    - WIKI_SECRET_KEY=
    - WIKI_UPGRADE_KEY=
  volumes:
    - "/data/wiki/images:/var/www/mediawiki/images"
  links:
    - db

nginx:
  image: discosquad/tdsnginx
  restart: always
  ports:
    - "80:80"
  links:
    - mediawiki
  volumes_from:
    - mediawiki

db:
  image: mysql:latest
  environment:
    - MYSQL_ROOT_PASSWORD=
  entrypoint: /bin/bash
  command: -c "while [ ! -f /docker-entrypoint-initdb.d/mediawiki.sql.gz ]; do echo 'Waiting for database import...'; sleep 1; done && /entrypoint.sh mysqld"
  restart: always
  volumes:
    - "/data/backup:/docker-entrypoint-initdb.d"

s3:
  image: amsdard/s3-sync
  restart: always
  volumes:
    - "/data/wiki:/data"
  environment:
    - S3_PATH=s3://tds-wiki/
    - DATA_PATH=/data/
    - ACCESS_KEY=
    - SECRET_KEY=

