mediawiki:
  image: chiefy/tdsmediawiki
  restart: always
  autoredeploy: true
  environment:
    - WIKI_URL=""
    - WIKI_DB_NAME=""
    - WIKI_DB_USER=""
    - WIKI_DB_PASSWORD=""
    - WIKI_SECRET_KEY=""
    - WIKI_UPGRADE_KEY=""
  volumes_from:
    - s3
  volumes:
    - /var/www/mediawiki
  links:
    - db

www:
  image: chiefy/tdsnginx
  autoredeploy: true
  restart: always
  ports:
    - "80:80"
  links:
    - mediawiki
  volumes_from:
    - mediawiki

db:
  image: mysql:latest
  environment:
    - MYSQL_ROOT_PASSWORD=""
  entrypoint: /bin/bash
  command: -c "while [ ! -f /var/import/backup/mediawiki.sql.gz ]; do echo 'Waiting for database import...'; sleep 1; done && cp /var/import/backup/mediawiki.sql.gz /docker-entrypoint-initdb.d/ && /entrypoint.sh mysqld"
  restart: always
  volumes_from:
    - s3

s3:
  image: amsdard/s3-sync
  restart: always
  volumes:
    - /var/import
  environment:
    - OWNER_UID=100
    - OWNER_GID=0
    - S3_PATH=s3://tds-wiki/
    - DATA_PATH=/var/import/
    - ACCESS_KEY=""
    - SECRET_KEY=""
